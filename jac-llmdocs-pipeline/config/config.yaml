# JAC LLM Documentation Pipeline Configuration
# Topic-Based Architecture: Extract → Merge → Format

# Prompt files for each stage (edit these to tune pipeline behavior)
prompts:
  extraction: "config/extraction_prompt.txt"   # Stage 1: Extract topic-specific content
  merge: "config/merge_prompt.txt"              # Stage 2: Merge within each topic
  format: "config/format_prompt.txt"            # Stage 3: Final compact formatting

# Source documentation directory (can be absolute or relative to pipeline root)
source_dir: "/home/kevinjin/jaseci-llmdocs/docs-new"

# LLM API Configuration
llm:
  provider: "openrouter"
  model: "google/gemini-2.5-flash"  # OpenRouter model identifier
  api_key_env: "OPENROUTER_API_KEY"
  max_tokens: 4096
  temperature: 0.0

  # Retry configuration for API errors
  max_retries: 3  # Number of retry attempts for 500/502/503/504/429 errors
  retry_delay: 2  # Initial delay in seconds (doubles with each retry)

# Processing options
processing:
  # Process files in parallel
  parallel: true
  max_workers: 16  # Increased for OpenRouter's high rate limits

  # Process sections within files in parallel
  parallel_sections: true
  section_workers: 8

  # Chunk size for large files (lines)
  chunk_size: 500

  # Skip files matching these patterns
  skip_patterns:
    - "*.html"
    - "*.css"
    - "*.js"
    - "index.md"
    - "README.md"

  # Categories to process (null = all)
  categories: null
  # categories: ["learn", "jac_book"]

# Stage 1: Topic Extraction
extraction:
  # Output directory for extracted topics (organized by topic)
  output_dir: "/home/kevinjin/jaseci-llmdocs/jac-llmdocs-pipeline/output/1_extracted"

# Stage 2: Topic Merging
merge:
  # Parallel workers for merging topics
  max_workers: 16

  # Output directory for merged topics (one file per topic)
  output_dir: "/home/kevinjin/jaseci-llmdocs/jac-llmdocs-pipeline/output/2_merged"

# Stage 3: Hierarchical Merge (NEW)
hierarchical_merge:
  # Output directory for intermediate and final merged files
  output_dir: "/home/kevinjin/jaseci-llmdocs/jac-llmdocs-pipeline/output/3_hierarchical"
  
  # Number of files to merge into one per pass (e.g., 4 -> 1)
  ratio: 4

# Stage 4: Final Formatting and Combining
ultra_compression:
  # Output filename for final reference doc
  output_file: "jac_docs_final.txt"

  # Output directory
  output_dir: "/home/kevinjin/jaseci-llmdocs/jac-llmdocs-pipeline/output/4_final"
